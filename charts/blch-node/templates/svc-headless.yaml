{{- $cosmosExporter := default (dict) (index .Values "cosmos-exporter") }}
{{- if or (eq .Values.blch.nodeType "sentry") (and $cosmosExporter.enabled) }}
{{- range $i := until (int .Values.replicas) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ $.Release.Name }}-headless-{{ $i }}
  labels:
{{ include "blch-node.labels" $ | nindent 4 }}
spec:
  clusterIP: None
  selector:
    app.kubernetes.io/name: {{ $.Release.Name }}
    statefulset.kubernetes.io/pod-name: {{ $.Release.Name }}-{{ $i }}
  ports:
  {{- if eq $.Values.blch.nodeType "sentry" }}
    - protocol: TCP
      port: 1234
      targetPort: 1234
      name: p2p
  {{- end }}
  {{- if and $.Values.cosmosExporter.enabled $.Values.cosmosExporter.localNodes.enabled }}
    - protocol: TCP
      port: 26657
      targetPort: 26657
      name: rpc
    - protocol: TCP
      port: 1317
      targetPort: 1317
      name: rest
  {{- end }}
  publishNotReadyAddresses: true
{{- end }}
{{- end }}
